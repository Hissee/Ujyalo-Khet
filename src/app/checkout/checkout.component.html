<div class="container my-4">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">
        <i class="bi bi-cart-check"></i> Checkout
      </h2>
      <button class="btn btn-outline-secondary mb-3" (click)="goBackToCart()">
        <i class="bi bi-arrow-left"></i> Back to Cart
      </button>
    </div>
  </div>

  @if (error) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      {{ error }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  }

  <div class="row">
    <!-- Delivery Address Form -->
    <div class="col-lg-7 mb-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-geo-alt"></i> Delivery Address</h5>
        </div>
        <div class="card-body">
          <form>
            <div class="mb-3">
              <label for="province" class="form-label">Province *</label>
              <input
                type="text"
                class="form-control"
                id="province"
                [(ngModel)]="deliveryAddress.province"
                name="province"
                placeholder="Enter province"
                required
              />
            </div>

            <div class="mb-3">
              <label for="city" class="form-label">City *</label>
              <input
                type="text"
                class="form-control"
                id="city"
                [(ngModel)]="deliveryAddress.city"
                name="city"
                placeholder="Enter city"
                required
              />
            </div>

            <div class="mb-3">
              <label for="street" class="form-label">Street Address *</label>
              <textarea
                class="form-control"
                id="street"
                [(ngModel)]="deliveryAddress.street"
                name="street"
                rows="3"
                placeholder="Enter street address"
                required
              ></textarea>
            </div>

            <div class="mb-3">
              <label for="phone" class="form-label">Phone Number *</label>
              <input
                type="tel"
                class="form-control"
                id="phone"
                [(ngModel)]="deliveryAddress.phone"
                name="phone"
                placeholder="Enter phone number"
                required
              />
            </div>
          </form>
        </div>
      </div>

      <!-- Payment Method Selection -->
      <div class="card mt-4">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-credit-card"></i> Payment Method</h5>
        </div>
        <div class="card-body">
          <div class="form-check mb-3">
            <input
              class="form-check-input"
              type="radio"
              name="paymentMethod"
              id="cashOnDelivery"
              value="cash_on_delivery"
              [(ngModel)]="paymentMethod"
            />
            <label class="form-check-label" for="cashOnDelivery">
              <strong>Cash on Delivery</strong>
              <p class="text-muted mb-0 small">Pay when you receive your order</p>
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="radio"
              name="paymentMethod"
              id="khalti"
              value="khalti"
              [(ngModel)]="paymentMethod"
            />
            <label class="form-check-label" for="khalti">
              <strong>Khalti</strong>
              <p class="text-muted mb-0 small">Pay securely with Khalti</p>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div class="col-lg-5">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Order Summary</h5>
        </div>
        <div class="card-body">
          <div class="order-items mb-3">
            @for (item of cartItems; track item.product.id) {
              <div class="d-flex justify-content-between mb-2 pb-2 border-bottom">
                <div>
                  <strong>{{ item.product.name }}</strong>
                  <br>
                  <small class="text-muted">Qty: {{ item.quantity }} Ã— Rs {{ item.product.price }}</small>
                </div>
                <strong>Rs {{ (item.product.price * item.quantity).toFixed(2) }}</strong>
              </div>
            }
          </div>

          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal:</span>
            <strong>Rs {{ totalPrice.toFixed(2) }}</strong>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Delivery:</span>
            <strong>Rs 0.00</strong>
          </div>
          <hr>
          <div class="d-flex justify-content-between mb-4">
            <h5>Total:</h5>
            <h5 class="text-primary">Rs {{ totalPrice.toFixed(2) }}</h5>
          </div>

          <button
            class="btn btn-primary btn-lg w-100"
            (click)="placeOrder()"
            [disabled]="loading || cartItems.length === 0">
            @if (loading) {
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              Processing...
            } @else {
              <i class="bi bi-check-circle"></i> 
              @if (paymentMethod === 'cash_on_delivery') {
                Place Order
              } @else {
                Pay with Khalti
              }
            }
          </button>

          <p class="text-muted small text-center mt-3">
            By placing an order, you agree to our terms and conditions
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
