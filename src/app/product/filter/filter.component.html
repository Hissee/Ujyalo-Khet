<div class="container my-4">
  <div class="row">
    <!-- Filter Sidebar -->
    <div class="col-lg-3 col-md-4 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            <i class="fas fa-filter"></i> Filters
          </h5>
        </div>
        <div class="card-body">
          <!-- Category Filter -->
          <div class="mb-4">
            <label class="form-label fw-bold">Category</label>
            <select class="form-select" [(ngModel)]="selectedCategory" (ngModelChange)="applyFilters()">
              @for (cat of categories; track cat) {
                <option [value]="cat">{{ cat.charAt(0).toUpperCase() + cat.slice(1) }}</option>
              }
            </select>
          </div>

          <!-- Price Filter -->
          <div class="mb-4">
            <label class="form-label fw-bold">Price (Rs/kg)</label>
            <div class="row g-2">
              <div class="col-6">
                <input 
                  type="number" 
                  class="form-control" 
                  placeholder="Min"
                  [(ngModel)]="minPrice"
                  (ngModelChange)="applyFilters()"
                  min="0"
                  step="0.01">
              </div>
              <div class="col-6">
                <input 
                  type="number" 
                  class="form-control" 
                  placeholder="Max"
                  [(ngModel)]="maxPrice"
                  (ngModelChange)="applyFilters()"
                  min="0"
                  step="0.01">
              </div>
            </div>
          </div>

          <!-- Harvest Date Filter -->
          <div class="mb-4">
            <label class="form-label fw-bold">Harvest Date</label>
            <div class="mb-2">
              <label class="form-label small">From</label>
              <input 
                type="date" 
                class="form-control"
                [(ngModel)]="startDate"
                (ngModelChange)="applyFilters()">
            </div>
            <div>
              <label class="form-label small">To</label>
              <input 
                type="date" 
                class="form-control"
                [(ngModel)]="endDate"
                (ngModelChange)="applyFilters()">
            </div>
          </div>

          <!-- Location Filter -->
          <div class="mb-4">
            <label class="form-label fw-bold">Location</label>
            <input 
              type="text" 
              class="form-control"
              placeholder="Enter location"
              [(ngModel)]="location"
              (ngModelChange)="applyFilters()"
              list="locationList">
            <datalist id="locationList">
              @for (loc of locations; track loc) {
                <option [value]="loc">{{ loc }}</option>
              }
            </datalist>
          </div>

          <!-- Reset Button -->
          <button 
            class="btn btn-outline-secondary w-100"
            (click)="resetFilters()">
            <i class="fas fa-redo"></i> Reset Filters
          </button>
        </div>
      </div>
    </div>

    <!-- Products List -->
    <div class="col-lg-9 col-md-8">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="mb-0">
          Filtered Products 
          <span class="badge bg-success">{{ filteredProducts.length }}</span>
        </h4>
      </div>

      @if (loading) {
        <div class="text-center py-5">
          <div class="spinner-border text-success" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2">Loading products...</p>
        </div>
      } @else if (filteredProducts.length === 0) {
        <div class="text-center py-5">
          <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
          <h5 class="text-muted">No products found</h5>
          <p class="text-muted">Try adjusting your filters</p>
        </div>
      } @else {
        <div class="row g-4">
          @for (product of filteredProducts; track product._id || product.id) {
            <div class="col-lg-4 col-md-6 col-sm-6 col-12">
              <div class="card product-card h-100" (click)="viewProduct(product)">
                <!-- Product Image -->
                <div class="product-image-wrapper">
                  <img 
                    [src]="getProductImage(product)" 
                    [alt]="product.name"
                    class="product-image"
                    (error)="handleImageError($event)">
                  @if (product.organic) {
                    <span class="product-badge organic-badge">
                      <i class="fas fa-leaf"></i> Organic
                    </span>
                  }
                </div>

                <!-- Product Info -->
                <div class="card-body">
                  <h5 class="card-title">{{ product.name }}</h5>
                  <p class="card-text text-muted small">{{ product.description || 'Fresh from the farm' }}</p>
                  
                  <div class="mb-2">
                    <strong class="text-success">Rs {{ product.price.toFixed(2) }}</strong> / kg
                  </div>
                  
                  <div class="mb-2 small text-muted">
                    <i class="fas fa-box"></i> Available: {{ product.quantity }} kg
                  </div>

                  @if (product.location) {
                    <div class="mb-2 small text-muted">
                      <i class="fas fa-map-marker-alt"></i> {{ product.location }}
                    </div>
                  }

                  @if (product.harvestDate) {
                    <div class="mb-2 small text-muted">
                      <i class="fas fa-calendar"></i> Harvested: {{ product.harvestDate | date }}
                    </div>
                  }

                  @if (product.farmerName) {
                    <div class="mb-2 small text-muted">
                      <i class="fas fa-user"></i> {{ product.farmerName }}
                    </div>
                  }

                  @if (!isFarmer) {
                    <button 
                      class="btn btn-success w-100 mt-2"
                      (click)="addToCart($event, product)"
                      [disabled]="product.quantity <= 0">
                      <i class="fas fa-cart-plus"></i>
                      @if (product.quantity <= 0) {
                        Out of Stock
                      } @else {
                        Add to Cart
                      }
                    </button>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>

