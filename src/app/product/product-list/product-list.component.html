<div class="container my-5">
  <div class="product-carousel-wrapper">
    <!-- Page Header -->
    <div class="mb-4">
      <h2 class="mb-3">
        <i class="bi bi-box-seam"></i> Our Products
      </h2>
      
      <!-- Category Filter Buttons -->
      <div class="category-filter-section">
        <div class="category-filter-label mb-2">
          <strong><i class="bi bi-funnel"></i> Filter by Category:</strong>
        </div>
        <div class="category-buttons">
          @for (category of categories; track category) {
            <button
              type="button"
              class="category-btn"
              [class.active]="selectedCategory === category"
              [class.category-fruits]="category === 'fruits'"
              [class.category-vegetables]="category === 'vegetables'"
              (click)="filterByCategory(category)">
              <span class="category-icon">
                @if (category === 'all') {
                  <i class="bi bi-grid-3x3-gap"></i>
                } @else if (category === 'fruits') {
                  <i class="bi bi-apple"></i>
                } @else if (category === 'vegetables') {
                  <i class="bi bi-flower1"></i>
                } @else if (category === 'grains') {
                  <i class="bi bi-basket"></i>
                } @else if (category === 'dairy') {
                  <i class="bi bi-cup-straw"></i>
                } @else if (category === 'herbs') {
                  <i class="bi bi-flower2"></i>
                } @else if (category === 'spices') {
                  <i class="bi bi-star"></i>
                } @else {
                  <i class="bi bi-box"></i>
                }
              </span>
              <span class="category-name">{{ category.charAt(0).toUpperCase() + category.slice(1) }}</span>
            </button>
          }
        </div>
      </div>
    </div>

    <!-- Carousel Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        @if (selectedCategory !== 'all') {
          <h5 class="text-muted mb-0">
            Showing {{ products.length }} {{ selectedCategory }}(s)
          </h5>
        } @else {
          <h5 class="text-muted mb-0">
            Showing all products ({{ products.length }})
          </h5>
        }
      </div>
      @if (totalSlides > 1) {
        <div class="carousel-controls">
          <button 
            class="btn btn-outline-primary carousel-nav-btn" 
            (click)="prevSlide()"
            [disabled]="totalSlides <= 1">
            <i class="bi bi-chevron-left"></i>
          </button>
          <span class="mx-2 text-muted">
            {{ currentSlide + 1 }} / {{ totalSlides }}
          </span>
          <button 
            class="btn btn-outline-primary carousel-nav-btn" 
            (click)="nextSlide()"
            [disabled]="totalSlides <= 1">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
      }
    </div>

    <!-- Carousel Container -->
    @if (products.length === 0) {
      <div class="empty-state text-center py-5">
        <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
        @if (selectedCategory !== 'all') {
          <h4 class="text-muted">No {{ selectedCategory }} available</h4>
          <p class="text-muted">Try selecting a different category or view all products.</p>
          <button 
            class="btn btn-primary mt-3" 
            (click)="filterByCategory('all')">
            <i class="bi bi-grid-3x3-gap"></i> View All Products
          </button>
        } @else {
          <h4 class="text-muted">No products available</h4>
          <p class="text-muted">Check back later for new products!</p>
        }
      </div>
    } @else {
      <div class="product-carousel-container">
        <div 
          class="product-carousel-track"
          [style.transform]="'translateX(-' + (currentSlide * 100) + '%)'">
          @for (slideIndex of getSlideIndices(); track slideIndex) {
            <div class="product-carousel-slide">
              <div class="row g-3">
                @for (product of getProductsForSlide(slideIndex); track product.id) {
                  <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="product-card h-100" (click)="navigateToProduct(product.id)">
                      <div class="product-image-wrapper">
                        @if (product.image) {
                          <img [src]="product.image" class="product-image" [alt]="product.name" 
                               (error)="handleImageError($event)">
                        } @else {
                          <div class="product-image-placeholder">
                            <i class="fas fa-image"></i>
                          </div>
                        }
                        <div class="product-badge">
                          <span class="badge-category" [ngClass]="getCategoryBadgeClass(product.category)">
                            {{ product.category }}
                          </span>
                        </div>
                        @if (product.quantity > 0) {
                          <div class="stock-badge">
                            <span class="badge-stock">In Stock</span>
                          </div>
                        } @else {
                          <div class="stock-badge">
                            <span class="badge-stock-out">Out of Stock</span>
                          </div>
                        }
                      </div>
                      
                      <div class="product-content">
                        <h5 class="product-title">{{ product.name }}</h5>
                        @if (product.description) {
                          <p class="product-description">
                            @if (product.description.length > 60) {
                              {{ product.description.substring(0, 60) }}...
                            } @else {
                              {{ product.description }}
                            }
                          </p>
                        }
                        <div class="product-footer">
                          <div class="product-price">
                            <span class="price-label">Price:</span>
                            <span class="price-value">Rs. {{ formatPrice(product.price) }}</span>
                          </div>
                          @if (product.quantity > 0) {
                            <span class="quantity-badge">{{ product.quantity }} kg available</span>
                          }
                        </div>
                        @if (!isFarmer) {
                          <button type="button" class="btn-add-to-cart" (click)="addToCart($event, product)">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Add to Cart</span>
                          </button>
                        }
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>

      <!-- Carousel Indicators -->
      @if (totalSlides > 1) {
        <div class="carousel-indicators-wrapper mt-4">
          <div class="carousel-indicators">
            @for (slideIndex of getSlideIndices(); track slideIndex) {
              <button
                class="carousel-indicator"
                [class.active]="currentSlide === slideIndex"
                (click)="goToSlide(slideIndex)"
                [attr.aria-label]="'Go to slide ' + (slideIndex + 1)">
              </button>
            }
          </div>
        </div>
      }
    }
  </div>
</div>
