<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow">
        <div class="card-body p-5">
          <!-- Header -->
          <div class="text-center mb-4">
            <h2 class="card-title mb-3">
              <i class="fas fa-envelope-circle-check text-success"></i>
              Email Verification
            </h2>
            <p class="text-muted">Verify your email address to complete your registration</p>
          </div>

          <!-- Success Message -->
          @if (verified) {
            <div class="alert alert-success text-center" role="alert">
              <i class="fas fa-check-circle me-2"></i>
              <strong>{{ successMessage }}</strong>
              <p class="mb-0 mt-2">Redirecting to login page...</p>
            </div>
          }

          <!-- Verification Form -->
          @if (!verified) {
            <!-- Error Message -->
            @if (errorMessage) {
              <div class="alert alert-danger" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                {{ errorMessage }}
              </div>
            }

            <!-- Success Message -->
            @if (successMessage) {
              <div class="alert alert-success" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                {{ successMessage }}
              </div>
            }

            <!-- Auto Verification Status -->
            @if (token && email && verifying) {
              <div class="alert alert-info text-center" role="alert">
                <div class="spinner-border spinner-border-sm me-2" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                Verifying your email...
              </div>
            }

            <!-- Manual Token Entry Form -->
            @if (!token || !email) {
              <form [formGroup]="verificationForm" (ngSubmit)="onSubmitVerification()">
                <div class="mb-3">
                  <label for="email" class="form-label">Email Address</label>
                  <input 
                    type="email" 
                    class="form-control" 
                    id="email"
                    [value]="email || ''"
                    readonly
                    [class.is-invalid]="email && !email.includes('@')">
                  @if (email) {
                    <small class="text-muted">Verification token will be sent to this email</small>
                  }
                </div>

                <div class="mb-3">
                  <label for="token" class="form-label">Verification Token</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="token"
                    formControlName="token"
                    placeholder="Enter the token from your email"
                    [class.is-invalid]="verificationForm.get('token')?.invalid && verificationForm.get('token')?.touched">
                  @if (verificationForm.get('token')?.invalid && verificationForm.get('token')?.touched) {
                    <div class="invalid-feedback">
                      Please enter the verification token
                    </div>
                  }
                  <small class="text-muted">Check your email inbox for the verification token</small>
                </div>

                <button 
                  type="submit" 
                  class="btn btn-success w-100"
                  [disabled]="verificationForm.invalid || verifying">
                  @if (verifying) {
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                    Verifying...
                  } @else {
                    <i class="fas fa-check me-2"></i>
                    Verify Email
                  }
                </button>
              </form>
            }

            <!-- Resend Verification Email Section -->
            <div class="mt-4 pt-4 border-top">
              <h5 class="mb-3">Didn't receive the email?</h5>
              
              @if (resendSuccessMessage) {
                <div class="alert alert-success" role="alert">
                  <i class="fas fa-check-circle me-2"></i>
                  {{ resendSuccessMessage }}
                </div>
              }

              @if (resendErrorMessage) {
                <div class="alert alert-danger" role="alert">
                  <i class="fas fa-exclamation-circle me-2"></i>
                  {{ resendErrorMessage }}
                </div>
              }

              <form [formGroup]="resendForm" (ngSubmit)="resendVerificationEmail()">
                <div class="mb-3">
                  <label for="resendEmail" class="form-label">Email Address</label>
                  <input 
                    type="email" 
                    class="form-control" 
                    id="resendEmail"
                    formControlName="email"
                    placeholder="Enter your email address"
                    [class.is-invalid]="resendForm.get('email')?.invalid && resendForm.get('email')?.touched">
                  @if (resendForm.get('email')?.invalid && resendForm.get('email')?.touched) {
                    <div class="invalid-feedback">
                      @if (resendForm.get('email')?.errors?.['required']) {
                        Email is required
                      } @else if (resendForm.get('email')?.errors?.['email']) {
                        Please enter a valid email address
                      }
                    </div>
                  }
                </div>

                <button 
                  type="submit" 
                  class="btn btn-outline-primary w-100"
                  [disabled]="resendForm.invalid || loading">
                  @if (loading) {
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                    Sending...
                  } @else {
                    <i class="fas fa-paper-plane me-2"></i>
                    Resend Verification Email
                  }
                </button>
              </form>
            </div>
          }

          <!-- Back to Login -->
          <div class="text-center mt-4">
            <button 
              type="button" 
              class="btn btn-link"
              (click)="goToLogin()">
              <i class="fas fa-arrow-left me-2"></i>
              Back to Login
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

